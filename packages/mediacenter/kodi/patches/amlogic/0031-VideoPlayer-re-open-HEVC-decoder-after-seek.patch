From 0914ca7fabf1fe2eae2fee1544ae452cc7349d0a Mon Sep 17 00:00:00 2001
From: afl1 <afl2001@gmail.com>
Date: Wed, 7 Aug 2019 04:32:50 +0100
Subject: [PATCH 31/43] VideoPlayer: re-open HEVC decoder after seek

Patch: kodi-ce-109-reopen-hevc-decoder-after-seek.patch
---
 xbmc/cores/VideoPlayer/DVDCodecs/Video/AMLCodec.cpp | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/xbmc/cores/VideoPlayer/DVDCodecs/Video/AMLCodec.cpp b/xbmc/cores/VideoPlayer/DVDCodecs/Video/AMLCodec.cpp
index 71105d3..a8d4c39 100644
--- a/xbmc/cores/VideoPlayer/DVDCodecs/Video/AMLCodec.cpp
+++ b/xbmc/cores/VideoPlayer/DVDCodecs/Video/AMLCodec.cpp
@@ -1869,6 +1869,15 @@ void CAMLCodec::Reset()
   if (!m_opened)
     return;
 
+  if (m_hints.codec == AV_CODEC_ID_HEVC && m_speed >= 0 && m_hints.width <= 1920)
+  {
+    if (CServiceBroker::GetSettingsComponent()->GetSettings()->GetBool(CSettings::SETTING_COREELEC_AMLOGIC_HEVCWORKAROUND))
+    {
+      CLog::Log(LOGDEBUG, "CAMLCodec::Reset - reopen HEVC");
+      m_dll->codec_close(&am_private->vcodec);
+      m_dll->codec_init(&am_private->vcodec);
+    }
+  }
   SetPollDevice(-1);
 
   // set the system blackout_policy to leave the last frame showing
-- 
2.7.4

