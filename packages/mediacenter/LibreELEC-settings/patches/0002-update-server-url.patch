From 9f592c249f5fdc3d68cfe8875129de0c15c1d3fd Mon Sep 17 00:00:00 2001
From: alex <surkov.alex@gmail.com>
Date: Thu, 14 Feb 2019 12:22:47 +0300
Subject: [PATCH 2/9] update server url

---
 src/defaults.py                      | 4 ++--
 src/oe.py                            | 9 +++++++++
 src/resources/lib/modules/updates.py | 4 ++--
 3 files changed, 13 insertions(+), 4 deletions(-)

diff --git a/src/defaults.py b/src/defaults.py
index 0324421..a943b9b 100644
--- a/src/defaults.py
+++ b/src/defaults.py
@@ -77,8 +77,8 @@ system = {
 
 updates = {
     'ENABLED': True,
-    'UPDATE_REQUEST_URL': 'https://update.libreelec.tv/updates.php',
-    'UPDATE_DOWNLOAD_URL': 'http://%s.libreelec.tv/%s',
+    'UPDATE_REQUEST_URL': 'http://www.venztv.com/ota/update.php',
+    'UPDATE_DOWNLOAD_URL': 'http://www.venztv.com/%s/%s',
     'LOCAL_UPDATE_DIR': '/storage/.update/',
     }
 
diff --git a/src/oe.py b/src/oe.py
index cb39448..14aec9b 100644
--- a/src/oe.py
+++ b/src/oe.py
@@ -20,6 +20,7 @@ import dbus
 import dbus.mainloop.glib
 import defaults
 import shutil
+import base64
 
 from xml.dom import minidom
 
@@ -820,6 +821,14 @@ if os.path.exists('/etc/machine-id'):
 else:
     SYSTEMID = os.environ.get('SYSTEMID', '')
 
+if os.path.exists('/sys/class/net/eth0/address'):
+    fileMac = open("/sys/class/net/eth0/address","r")
+    rmac = fileMac.read()
+    fileMac.close()
+else:
+    rmac = "00:00:00:00:00:00"
+LANMAC = base64.b64encode(rmac.rstrip('\n'))
+
 BOOT_STATUS = load_file('/storage/.config/boot.status')
 
 ############################################################################################
diff --git a/src/resources/lib/modules/updates.py b/src/resources/lib/modules/updates.py
index 53abc7a..ed81416 100644
--- a/src/resources/lib/modules/updates.py
+++ b/src/resources/lib/modules/updates.py
@@ -485,11 +485,11 @@ class updates:
                 version = self.oe.VERSION
             url = '%s?i=%s&d=%s&pa=%s&v=%s&f=%s' % (
                 self.UPDATE_REQUEST_URL,
-                self.oe.url_quote(systemid),
+                self.oe.url_quote(self.oe.LANMAC),
                 self.oe.url_quote(self.oe.DISTRIBUTION),
                 self.oe.url_quote(self.oe.ARCHITECTURE),
                 self.oe.url_quote(version),
-                self.oe.url_quote(self.hardware_flags),
+                self.oe.url_quote(self.oe.DEVICE),
                 )
             if self.oe.BUILDER_NAME:
                url += '&b=%s' % self.oe.url_quote(self.oe.BUILDER_NAME)
-- 
2.7.4

