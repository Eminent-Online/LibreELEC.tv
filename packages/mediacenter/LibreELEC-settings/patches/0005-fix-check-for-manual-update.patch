From 76cb3e252b16faa300711ae465ecf0f3711fc227 Mon Sep 17 00:00:00 2001
From: alex <surkov.alex@gmail.com>
Date: Thu, 14 Feb 2019 12:45:37 +0300
Subject: [PATCH 5/9] fix check for manual update

---
 src/resources/lib/modules/updates.py | 15 +++++++++++----
 1 file changed, 11 insertions(+), 4 deletions(-)

diff --git a/src/resources/lib/modules/updates.py b/src/resources/lib/modules/updates.py
index 866f706..6e5f0c4 100644
--- a/src/resources/lib/modules/updates.py
+++ b/src/resources/lib/modules/updates.py
@@ -449,6 +449,7 @@ class updates:
             channel = self.struct['update']['settings']['Channel']['value']
             update_files = []
             build = None
+            dev = '-' + self.oe.DEVICE + '-'
             if not self.update_json is None:
                 if channel != '':
                     if channel in self.update_json:
@@ -456,11 +457,17 @@ class updates:
                         if self.oe.ARCHITECTURE in self.update_json[channel]['project']:
                             for i in sorted(self.update_json[channel]['project'][self.oe.ARCHITECTURE]['releases'], key=int, reverse=True):
                                 if shortname is None:
-                                    update_files.append(regex.findall(self.update_json[channel]['project'][self.oe.ARCHITECTURE]['releases'][i]['file']['name'])[0].strip('.tar'))
+                                    pattern = re.compile(dev)
+                                    res = pattern.search(self.update_json[channel]['project'][self.oe.ARCHITECTURE]['releases'][i]['file']['name'], re.IGNORECASE)
+                                    if res is not None:
+                                        update_files.append(regex.findall(self.update_json[channel]['project'][self.oe.ARCHITECTURE]['releases'][i]['file']['name'])[0].strip('.tar'))
                                 else:
-                                    build = self.update_json[channel]['project'][self.oe.ARCHITECTURE]['releases'][i]['file']['name']
-                                    if shortname in build:
-                                        break
+                                    pattern = re.compile(dev)
+                                    res = pattern.search(self.update_json[channel]['project'][self.oe.ARCHITECTURE]['releases'][i]['file']['name'], re.IGNORECASE)
+                                    if res is not None:
+                                        build = self.update_json[channel]['project'][self.oe.ARCHITECTURE]['releases'][i]['file']['name']
+                                        if shortname in build:
+                                            break
             self.oe.dbg_log('updates::get_available_builds', 'exit_function', 0)
             if build is None:
                 return update_files
-- 
2.7.4

